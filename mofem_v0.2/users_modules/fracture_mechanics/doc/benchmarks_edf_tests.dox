/*! \page benchmarks_edf_tets Benchmarks crack propagation tests (EDF Tests)

The following tests have been designed to check capabilities and robustness of
crack propagation tools in MoFEM.

Three test are investigated,
- test case 1: loading of a brick slice
- test case 2: loading on a full-size brick
- test case 3: loading on a full-size with partial length keyways

Full test specification and geometrical description is available under following
<a href="edf_test_specification.pdf" target="_blank"><b>link.</b></a>

This work is motivated by inability of commercial finite element codes to
simulate crack propagation in brittle materials in structural elements with
nontrivial geometry. Open source codes like MoFEM (or Code_Aster) are developed
to fill that gap and deliver open tool which can be used by industry.

\tableofcontents

\section theory Solution scheme and theoretical context

In the following document calculations are based on theoretical developments presented
in paper by Kaczmarczy & Pearce \cite kaczmarczyk2014three. In paper \cite
kaczmarczyk2014three a derivation of equations for equilibrium of crack front
from first principles is shown, i.e. the first law of thermodynamics and
principle of maximal dissipation of energy (particular case of second low of
thermodynamics). Problem is formulated in context of configurational (Elshebian)
mechanics for convenience. Crack front is subjected to a constrain emerging form
Griffith fracture criterion.

Independently from theoretical development a method based on face splitting is
proposed to propagate crack in \cite kaczmarczyk2014three. However in this work
alternative, novel approach is proposed, leading to implicit, smooth and
consistent crack propagation. In following tests crack is  propagated by
directly displacing crack front nodes in material reference configuration. This
approach is distinct to well know methods, where crack propagation is realized
by enriching nodes (X-FEM), re-meshing or face splitting. It enables to move
crack front continuously by arbitrary implicitly calculated distance, based on
crack front equilibrium condition subjected to Griffith constrain, where as in
alternative approaches crack is extended in some discrete predefined distances.

In presented approach, smooth evolution of crack geometry  results in mesh
distortion, to resolve that issue a efficient mesh smoothing technique is
implemented  \ref VolumeLengthQuality (see \cite kaczmarczyk2014three and
implemented in constrains \ref SurfaceSlidingConstrains). This result in problem
tailored variant of Total Arbitrary Lagrangian Formulation (T-ALE), in such a
way that mesh smoothing not influencing crack propagation.

Mesh smoothing is not sufficient to fully propagate crack over whole thickness
of the body. A face flipping, node merger and edge splitting algorithm is
further added to algorithm. After each converged load step a mesh topological
changes are introduced to improve mesh quality in neighborhood of crack front.
Note that at that point, crack geometry is fixed, mesh topological changes don't change
crack geometry itself, but improve mesh quality in neighborhood of crack front. In other
words, re-meshing or mesh flipping is not used here to propagate crack but to maintain
mesh quality.

A finite element in T-ALE setting is implemented in \ref nonlinear_elastic_elem.
Finite element calculate spatial and material forces, which drives body
deformation in physical space and crack front displacements in material space.
Material  forces acting at crack front are equilibrated by Griffith forces
(material resistant forces). Griffith force element is implemented in \ref
GriffithForceElement.

In this approach crack propagates only in mode I, since crack front position
and direction are calculated implicitly at once, in such a way that maintain
equilibrium at crack front at the end of load step. In classical approach
equilibrium is condition is not used, only Griffith criterion  (or any other) is
applied, and crack is extended based on the stress state at beginning of step.
Since crack evolution is strongly nonlinear this could result in mixed mode
stress mode when crack is extended and demand appropriate calculation of crack
direction for mixed mode, leading to explicit calculation of crack path.

It is important to stress that propagating mode-II cracks are usually not
observed experimentally in homogeneous isotropic solids. A crack subjected to
mode-II or mixed mode loading, curves or kinks and propagates in a direction
that maintains locally pure mode-I conditions at the tip \cite CotterellAndRice
\cite hutchinson1992mixed. This is consistent with the approach we have adopted,
achieving maximum dissipation of energy in the generation of new crack area and
crack front equilibrium.


\section quasi_static Quasi static crack propagation

In all tests is assumed that crack is propagating quasi-statically. This
assumption is satisfied by controlling force such that material displacements of
crack front lead to slow total crack area increase. In presented approach a
problem tailored arc-length technique is adopted, see \cite kaczmarczyk2014three
for details. Since crack propagation is understood here as a evolution of body
topology, a strongly non-linear process, a increment of crack area is controlled
and size of it is automatically adapted to obtain desired number of Newton-Raphson
iteration at each load step.

\section algorithm Algorithm

- build problem for given body geometry, crack surface, applied loads and given crack area increment

- solve system on nonlinear algebraic equations for displacements, crack front position and load
factor. Note that crack front positions are not directly controlled, a
force factor is implicitly calculated to increase total crack are by desired quantity.

- post-process results and record at given step

- adapt next crack area increment to get desired number of iterations (4-5
iterations) for next step

- update mesh for next step (merge nodes, split edges, flip faces such that mesh
quality in crack front neighborhood is improved)

\section tests Tests

\subsection brick_slice Brick slice with slot (Loading with pure bending applied to slot edges)

\subsubsection statistic_slice Statistics

- 33565, Degrees of Freedom (this is number of nodes at being of analysis, this
number can change insignificantly during analysis)
- 133, Load Steps
- 57 seconds, Approximate step time (Laptop, 2.3 GHz Intel Core i7, 4 cores)

\subsubsection results_slice Results

\image html slice_anim.gif "Brick slice (animation)"

A brick slice is subjected to forces applied on top and bottom slot edges. Edge
forces have the same magnitude but opposite directions, that make couple of forces
and pure bending moment is applied, see <a href="edf_test_specification.pdf"
target="_blank"><b>link</b></a> for details.

Crack is initialised at the keyway corner. Size if initial notch is
constrained by mesh size. Initial analysis showed that size or shape of initial
notch do not influence final crack propagation significantly.

Since element is subjected to pure bending, at any arbitrary cros-section of
brick, no net axial force is present. As result material points in vicinity of
crack front are subjected to tension, wheres near the bore surface material  is
in compression. This prevent crack to propagate fully through the brick and
elastic hinge is created at the end of analysis.

It can noted that any partial crack propagation through the bore would lead to
self penetration of crack surfaces, since compressible stresses are acting next
to the bore, to transfer externally apply bending moment. This indirectly
validate crack front equilibrium equations derived in \cite
kaczmarczyk2014three. Note that from Griffith criterion itself, or any other
criterion (f.e. stress based) can not be calculated how far crack would
propagate. Therefore in this and following test can be shown that odes at crack
front approaching the bore surface such that calculated griffith force is equal
to material resistance, i.e. \f$g = g_c\f$, however displacements at those nodes
are approaching zero, since crack can propagate to the neutral axis (in
extreme), which is is in the limit always in half the distance between crack
front and bore surface, therefore in next step crack can propagate half of its
previous distance an so on for following steps. As results crack will reach the
bore in infinite number of steps (this justification is valid for ideal
structure and assumption of small trains and displacements).

\image html crack_surface_slice.png "Brick slice (crack snapshots)"
\image html crack_surface_slice_side_view.png "Brick slice (crack snapshots - side view)"
\image html deformed_slice.png "Brick slice"

On above figures are shown subsequent snapshots of crack propagation, where red
triangle represent initial crack notch. Note that crack propagation is not planar
and is slightly bending toward the slot.

\image html load_path_fracture_slice.png "Load-diaplcement path (Brick slice)"

Figure above shows load-displacement path, with generalised displacement and
force load factor, on x-axis and y-axis, respectively. The generalised displacement
not represent particular point on structure, but its value is work conjugated to
applied forces and is calculated from formula,
\f[
\Psi = \frac{1}{2} u (\lambda f),\; \textrm{thus}\quad
u  = 2 \frac{\Psi}{\lambda f}
\f]
where \f$f=1\f$[N] is reference force, \f$\Psi\f$ is elastic energy,
\f$\lambda\f$ is load factor and \f$u\f$ is generalised displacement. The
generalized displacement is used to present objectively results,
since it not depend on subjectively picked reference point. Load-displacement
plot is obtained using arc-length control, such that external force is
controlled to get crack area grow at each step. This results in unique
\em maximal \em dissipative \em loading \em path. Since maximal dissipation of energy drives
crack propagation direction, this plot represents equilibrium path and crack surface which
result with maximal possible crack release of energy, therfore any other shape
of crack front or crack surface would release less strain energy. However for
further verification those calculations should be repeated for denser meshes and
higher order of approximation order, to verify of quality of finite element
approximation itself.

\image html area_vs_energy_slice.png "Crack area vs Elastic Energy (Brick slice)"

One can note that energy release rate is assumed constant (\f$g_c\f$) and it is
material parameter. However on structural level, the crack area vs strain energy
plot shows that slope of curve is not constant over the analysis. The explanation for
varying slop of curve is explained by two factors;

- Length of crack front at which energy is released is not constant. It getting
longer up to the point where opposite side of the bore is reached. After that
getting shorter, ultimately to get fixed length equal to brick length. Look at
snapshots with crack surface.

- Topology of the body is evolving as result displacement vector, at points were
external force is applied, is changing. Thus work of external forces is varying
from one step to another.

Note, that can be easily shown (both analytically and numerically), that for
long (infinite) plate with the notch, slope on crack area vs strain energy plot
is constant. Since crack front length is constant and forces are applied in far distance
from crack itself.

One can note the jump on both of the plots above. This is outcome of numerical
artifact. In current algorithm by default once crack front approach corner,
crack is automatically extended to pass the corner. Increasing mesh density will
reduce that effect. In practice for such test this algorithm feature can be switched off
to avoid this behavior, because of nature of loading. However it can be noted
that cracking corner not influences results significantly and results for this
test are still valid.

\subsubsection input_data_slice Input data and running the code

\include users_modules/fracture_mechanics/examples/brick_slice_b2.jou

Following program calculates Griffith forces for initial crack configuration,
allowing user to define refinement level at the crack front. It generates
starting file \em out_spatial_2_0.h5m for crack propagation program.
\code
convergence_study.sh -f brick_slice_b2.cub -l 1 -g 1.4e-7 -o 2 -r 0 -d BrickSlice -p 4
\endcode
where:

- -f brick_slice_b2.cub mesh file
- -l 1, initial load factor
- -g 1.4-7, material parameter, strain energy release rate (Note that unit is [J/m^2 10^(-9)])
- -o 2, set approximation order to quadratic functions
- -r 0, set mesh refinement level at crack front, 0 no refinementt
- -d BrickSlice, directory where results are stored

This program do crack propagation,
\code
arc_length.sh \
  -f BrickSlice/out_spatial_2_0.h5m -a 1e-6 -g 1.4e-7 \
  -n 2000 -i 6 -t 5e-10 \
  --my_arc_alpha=1e-4 \
  --my_other_side_constrain=1 \
  -d BrickSlice \
  -p 4
\endcode
where additional parameters are,

- -a initial crack area increment, over analysis step size is adapted to achieved
desired number of iterations. It control arc-legth method.

- -i 6, desired number of iterations for load step.

- -t 5e-10, tolerance for Newton-Raphson method

- -my_arc_alpha 1e-4, it scale residual for arc-length method, i.e. what is
tolerance for residual of controlling function in respect to residual of
global system of equations.

- --my_other_side_constrain=1, indicate that initially some nodes of crack front are at
corner edge, defined by to intersection body (skin) surface.

\subsection brick_full Full size brick with slot (Loading with pure bending applied to slot edge)

\subsubsection statistics_full Statistics

- 119588, Degrees of Freedom (this is number of nodes at being of analysis, this
number can change insignificantly during analysis)
- 550, Load Steps
- 57 seconds, Approximate step time (<a href="http://www.archie-west.ac.uk/information/archie-specification/">ARCHI-WEST</a>, 24 cores)

\subsubsection results_full Results

\image html brick_full_anim1.gif "Full brick (animation)"
\image html brick_full_anim2.gif "Full brick (animation)"

The crack propagation for full brick is similar to previous example, crack
propagate along the corner. Initiated form corner notch on one of the brick
sided moves to opposite side and then trough the bore. Since pure bending
moment is applied by edge forces on brick slot no axial force force is present
at brick correction, preventing full break. In real brick loading, resulting from
keyway load or internal stress it can be expected that pattern of crack propagation
would be different, like is shown in next example. However this test validating code and
its robustness, in the sense that results show expected results for given load scenario.

\image html crack_surface_full_1.png "Full brick (crack snapshots 1)"
\image html crack_surface_full_2.png "Full brick (crack snapshots 2)"
\image html crack_surface_full_3.png "Full brick (crack snapshots 3)"
\image html deformed_full.png "Full brick (deformed shape)"

In above figures it is shown how crack propagate in subsequent snapshots. Crack is
insignificantly bending over analysis, however it approach surface of the bore ob
the angle what can be observed in figure presenting brick deformation.

\image html load_path_fracture_full.png "Load-displacement path (Full brick)"
\image html crack_area_vs_energy_full.png "Crack area vs Elastic Energy (Full brick)"

In above plots load-displacemnt path and strain energy against crack area is
shown. It is more complex that for brick slice, and three stages of crack
propagation  can be identified, i.e. propagation crack  to the opposite brick
surface, propagation to the bore and creation of elastic hinge (where load-disp
path achieve quasi plateau).

Analysis of load path enables better understanding of component safety, notting that if

- \f$\delta u_i > 0\f$ and \f$\delta \lambda_i > 0\f$ crack propagation is unconditionally stabile,

- \f$\delta u_i > 0\f$ and \f$\delta \lambda_i < 0\f$ crack propagation is
stabile if kinematic loading is applied, unstable if static loading is applied,

- \f$\delta u_i < 0\f$ and \f$\delta \lambda_i < 0\f$ crack is unconditionally unstable, unless both
displacements and loads are controlled,

where \f$\delta u_i\f$ and \f$\delta \lambda_i\f$ are increments of
displacements and forces at load step \f$i\f$.

It can be noted that for brick slice and full brick, crack propagation is
unconditionally unstable, until snap-back point at the end of analysis where
elastic hinge is created. After that point crack propagation is conditionally stabile,
if kinematic control is applied (brick is kinematically restrain, for example loaded by
constrained key on keyway).

\subsubsection input_data_full Input data and running the code

Full brick model is very similar to brick slice, only difference is brick length
which is set according to specification in <a href="edf_test_specification.pdf" target="_blank"><b>link.</b></a>
Code was run with the same input parameters as in previous example, only difference is that number of processors was increased to 24 and
calculations were executed on <a href="http://www.archie-west.ac.uk/information/archie-specification/">ARCHI-WEST.</a>

\include users_modules/fracture_mechanics/examples/brick_b2.jou

\subsection long_brick Loading full brick with partial length keyways

\subsubsection statistics_long Statistics

- 117209, Degrees of Freedom (this is number of nodes at being of analysis, this
number can change insignificantly during analysis)
- 1639, Load Steps
- 47 seconds, Approximate step time (<a href="http://www.archie-west.ac.uk/information/archie-specification/">ARCHI-WEST</a>, 24 cores)

\subsubsection results_long Results

\image html bick_long_anim.gif "Long brick (animation)"

This test has complex geometry and crack propagation path comparing to test
1 and test 2. As results of different loading scenario, defined here
<a href="edf_test_specification.pdf" target="_blank"><b>link.</b></a>, where ripping
loads are applied at key way, crack initially propagate along edge, and next to the bore. Next
it propagates along the brick to its opposite side. This loading scenario is more realistic
to real brick, where applied forces in the test mimicking loading from key.

\image html crack_surface_long.png "Long brick (crack surface)"
\image html carck_surface_side_view_long.png "Long brick (crack surface - side view)"
\image html deformation_long.png "Long brick (deformation)"

On above figures can be seen that crack propagation has several stages, and
initially is planar, however it approach the bore surface on some angle. Once
crack front pass trough keyway is no longer planar for some distance.

In that test during simulation code encountered some difficulties emerging from
coarse mesh. Calculations have been stopped just before crack front reach
opposite side due to deteriorated mesh quality. This difficulty will be removed
in next mofem release.

\image html load_path_fracture_long.png "Load-displacement (Long brick)"
\image html crack_area_vs_energy_long.png "Crack area vs Elastic Energy (Long Brick)"

Analysing load displacement path, can be noted that it reflect complex
path propagation, where initially crack is unconditionally unstable. Next on the
graphs it can be seen snap-bakc point, before crack front reach the end of the
keyway. From that point crack propagation is conditionally stabile, i.e. if
brick is physically loaded by key way, cack propagating in stabile banner, other
bricks need to be displacement to evolve crack geometry. At point where crack
front passing through end of key way, a clear jump is shown on load displacement
path. It can be noted that before and after that point, the tangent operator is
positive and further increase of crack area demands increase of loading force, i.e. crack
propagation is unconditionally stabile. As result snap-through is possible,
which can be interpreted that such loaded brick will partially break, and crack
propagation will freeze if constant ultimate load is applied (this assuming that
inertia effects could be neglected).

Above comments shows great advantage from crack modeling technique implemented
here, allowing for better understating of crack propagation, delivering not only crack
topology but in addition insight in stability of crack propagation. This enables
better judgment about safety of component under considered loading.

\subsubsection input_data_long Input data and running the code

This test were run with the same command like in previous examples. Input mesh model is
generated form journal file shown below.
\include users_modules/fracture_mechanics/examples/long_brick.jou

\image html gemetry_of_keyway_long.png "Geometry of keyway for long brick"

Following model is geometry of keyway is modified to enable smooth transfer form
edge propagating crack to crack propagation on free surface. This simplification
is not expected to change final crack path, however in future alternative options
could be considered, both by different model with denser mesh and dedicated
algorithm for resolving such geometrical singularities.

\section issues Efficiency & robustness

Overall MoFEM pass tests successfully, however with some difficulties. It is key
to note that results showed sensitivity to applied boundary conditions, showing
differences between tests, in particular when type of loading is changed. This
shows quality if obtain results and predictive potential of presented
methodology. MoFEM is able to deliver information about  crack surface, front
propagation and load displacements path, this enables engineers for greater interpretation,
safety and risk assessment.

Current version of code is build progressively along research in the field and
better understanding of configurational mechanics in context of crack
propagation. Such development led to some inefficient (but correct) performance
bottlenecks. As results code runs slower than expected.

- Mesh is smoothed in whole domain of the body, in future version this will be restricted
to close vicinity of the crack, as result number of DoFS can be significantly reduced and
some non-linerities removed form system of equations.

- Above as well will remove some mesh distortion in regions in some distance from crack front, which
lead to difficulties experienced on long brick problem.

- Algorithms maintaining mesh quality, such as face flipping or local re-meshing
could be improved by meter integration with
<a href="http://press3.mcs.anl.gov/sigma/meshkit-library/">MeshKit Library</a>
tools available through
<a href="http://press3.mcs.anl.gov/sigma/moab-library/">MoAB Library</a>
library. This could significantly increase robustness of the code.

- Above at hand could better resolve issues with complex geometrical fetchers
like end of keyway in long brick problem.

- Doing analysis, in particular for last problems a convergence issues where
occurring. This demanded manual adjustment of load step size. It is a need for better
algorithms for step reduction and automatized action in case of difficulties.

- In current input user need to specify body surface edges, crack surface and
crack front edges. In addition is needed to define corner edges, where two faces
are meeting and corners nodes when three surfaces are meeting. This could be
automatised such that user will not need to specify those manually, removing
potential source of mistakes.

- Surface constrain maintained body geometry are enforced using Lagrange
multipliers. It is undergoing work to use Nitche's method, that will reduce
system of equations and improve matrix quality.

- In order to improve efficient elements and matrix associated with elements with
some distance from crack front coords_at_Gauss_nodes be build and factored only
once at beginning of analysis. Only nodes in near the crack, where mesh
smoothing and face flipping can be recalculated. That could significantly
increase speed of calculations allowing for much denser problems.



*/
