PreBuild:
  - sudo apt-get install -y libopenmpi-dev openmpi-bin openssh-server libblas-dev liblapack-dev
  - cd /
  - sudo wget --quiet https://www.dropbox.com/s/axa48op5mevukfj/mofem_env.tar.gz
  - sudo tar -xzf mofem_env.tar.gz
  - sudo chmod -R aug+rX /opt
  - sudo rm -f mofem_env.tar.gz
Build:
  - export MOFEM_SRC_DIR=$PWD
  - export MOFEM_INSTALL_DIR=$PWD/um
  - export MOFEM_BUILD_DIR=$PWD/lib
  - export PETSC_DIR=/opt/petsc
  - export PETSC_ARCH=arch-linux2-c-opt
  - mkdir -p $MOFEM_BUILD_DIR
  - cd $MOFEM_BUILD_DIR
  >
    /opt/bin/cmake
    -DCMAKE_BUILD_TYPE=MinSizeRel
    -DBUILD_SHARED_LIBS=1
    -DCMAKE_CXX_FLAGS="-Wall"
    -DPETSC_DIR=$PETSC_DIR
    -DPETSC_ARCH=$PETSC_ARCH
    -DMOAB_DIR=$PETSC_DIR/$PETSC_ARCH
    -DWITH_ADOL-C=1
    -DCMAKE_INSTALL_PREFIX=$MOFEM_INSTALL_DIR
    -$MOFEM_SRC_DIR/mofem
  - echo "Build"
  - make install
  - ctest --output-on-failure
AfterBuildSuccess:
  - cd $MOFEM_INSTALL_DIR/basic_finite_elements/atom_tests
  - make
  - ctest --output-on-failure
PkgInclude:
    - '*'
