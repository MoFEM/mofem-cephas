FROM likask/mofem-spack-build

LABEL maintainer="Lukasz.Kaczmarczyk@glasgow.ac.uk"

RUN apt-get update && \
  apt-get install -y \
  python3-pip \
  libgl1-mesa-glx \
  libglu1-mesa \
  xvfb \
  build-essential \
  python3-dev \
  npm \
  nodejs \
  libnode64 \
  && apt-get clean && rm -rf /var/lib/apt/lists/*  

RUN pip3 -q install pip --upgrade && \
  pip3 install \
  pandas \
  pyvista \
  jupyter \
  jupyterhub \
  jupyter_contrib_nbextensions \
  itkwidgets \
  ipywidgets \
  ipyvtk-simple==0.1.2 && \
  jupyter contrib nbextension install --user && \
  jupyter nbextension enable spellchecker/main && \
  npm install -g configurable-http-proxy

#RUN useradd -ms /bin/bash mofem
#USER mofem

# allow jupyterlab for ipyvtk
ENV DISPLAY=:99.0
ENV JUPYTER_ENABLE_LAB=yes
ENV PYVISTA_USE_IPYVTK=true

WORKDIR $MOFEM_INSTALL_DIR

CMD /bin/bash -c "Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &" && \
  jupyter notebook --port=8888 --no-browser --ip=0.0.0.0 --allow-root

