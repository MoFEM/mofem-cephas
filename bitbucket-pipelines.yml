image: likask/mofem-spack-env:latest

pipelines:
  default:
    - step:
        script:
          - echo PWD $PWD
          - git submodule update --init mofem/users_modules
          - export MOFEM_SRC_DIR=$PWD
          - echo MOFEM_SRC_DIR $MOFEM_SRC_DIR
          - echo "Install with spack"
          - . $SPACK_ROOT_DIR/share/spack/setup-env.sh
          - spack dev-build -j 2 --source-path $MOFEM_SRC_DIR --test root mofem-cephas@develop~copy_user_modules+docker target=x86_64 build_type=Release ^petsc+X 
